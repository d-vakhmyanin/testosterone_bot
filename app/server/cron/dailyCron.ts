import { CronJob } from 'cron';
import path from 'path';

import { ChatIdsMap, CronJobParameters } from './common';

import { TRAINING_CONFIG } from './../config';
import { loadChatData } from '../utils/fs';
import { getUsernameTag } from '../utils/getUsername';
import { getRandom } from './../utils/getRandom';

const getMediaFilePath = (fileName: string) => path.join(process.cwd(), 'app', 'server', 'assets', fileName)

const allMarkedMessages = [
    "Ð’ÑÐµ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»Ð¸ÑÑŒ? Ð¡ÐµÑ€ÑŒÑ‘Ð·Ð½Ð¾? ðŸ˜ Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð²ÐµÑ€Ð¸Ñ‚. ÐžÐ½ ÑƒÐ¶Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ 'ÑÑŽÑ€Ð¿Ñ€Ð¸Ð·' Ð´Ð»Ñ Ñ‚ÐµÑ…, ÐºÑ‚Ð¾ Ð½Ðµ ÑÐ²Ð¸Ñ‚ÑÑ. â°",
    'Ðž, Ð²ÑÐµ Ð² ÑÐ¿Ð¸ÑÐºÐµ? Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ Ñ…Ð¼Ñ‹ÐºÐ°ÐµÑ‚: Â«ÐÑƒ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼...Â» Ð•ÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ ÑÐ»Ð¸Ð½ÑÐµÑ‚ â€” Ð¾Ð½ ÑÑ‚Ð°Ð½ÐµÑ‚ Ð¼ÐµÐ¼Ð¾Ð¼ Ñ€Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¾Ð¹ ÐºÐ°Ñ‡Ð°Ð»ÐºÐ¸. ðŸ‹ï¸â€â™‚ï¸ðŸ’€',
    'Ð Ð¾Ð Ð¾ Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½? ÐÐµÑ‚. ÐžÐ½ Ð¶Ð´ÐµÑ‚. Ð•ÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ â€” ÐµÐ³Ð¾ Ð¸Ð¼Ñ Ð²Ñ‹Ð³Ñ€Ð°Ð²Ð¸Ñ€ÑƒÑŽÑ‚ Ð½Ð° Ð”Ð¾ÑÐºÐµ ÐŸÐ¾Ð·Ð¾Ñ€Ð° Ð Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¾Ð¹ ÐšÐ°Ñ‡Ð°Ð»ÐºÐ¸. â°',
    'Ð’ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ°Ð»Ð¸ÑÑŒ? Ð¥Ð¼... Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¼Ð¾Ð»Ñ‡Ð¸Ñ‚. Ð›ÑƒÑ‡ÑˆÐµ Ð½Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ð½ÐµÐ³Ð¾ Ð½Ð° ÑƒÐ¼Ðµ. ðŸšªðŸ’¥',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ð½Ðµ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ â€” Ñ ÐµÐ³Ð¾ Ð½Ð°Ð¹Ð´Ñƒ.Â» Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ñ€Ð¸ÑÐºÐ½ÑƒÑ‚ÑŒ? â°',
    'Ð Ð¾Ð Ð¾ ÐºÐ¸Ð²Ð½ÑƒÐ», Ð½Ð¾ ÐµÐ³Ð¾ Ð³Ð»Ð°Ð·Ð° Ð³Ð¾Ð²Ð¾Ñ€ÑÑ‚: Â«Ð¯ Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŽ.Â» ÐÐµ Ð¿Ð¾Ð´Ð²ÐµÐ´Ð¸Ñ‚Ðµ, Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð»ÐµÐ³ÐµÐ½Ð´Ð¾Ð¹ ÑÐ»Ð°Ð±Ð¾ÑÑ‚Ð¸. ðŸ’ªðŸ”¥',
    "Ð’ÑÐµ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»Ð¸ÑÑŒ? Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾. ÐÐ¾ Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ ÑƒÐ¶Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ 'Ð¾ÑÐ¾Ð±Ñ‹Ð¹' ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÑŒÑ‰Ð¸ÐºÐ¾Ð². ðŸ‹ï¸â€â™‚ï¸ðŸ˜ˆ",
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑƒÑ…Ð¼Ñ‹Ð»ÑÐµÑ‚ÑÑ: Â«Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¸Ð· Ð²Ð°Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¿Ñ€Ð¸Ð´ÐµÑ‚?Â» ÐÐµ Ð´Ð°Ð¹Ñ‚Ðµ ÐµÐ¼Ñƒ Ð¿Ð¾Ð²Ð¾Ð´Ð° Ñ€Ð°Ð·Ð¾Ñ‡Ð°Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ. â°',
    'Ð Ð¾Ð Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ°Ð» Ð²ÑÐµÑ… Ð² Ð±Ð»Ð¾ÐºÐ½Ð¾Ñ‚. Ð•ÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ ÑÐ²Ð¸Ñ‚ÑÑ â€” ÐµÐ³Ð¾ Ñ„Ð¾Ñ‚Ð¾ Ð¿Ð¾Ð²ÐµÑÑÑ‚ Ð² Ñ€Ð°Ð·Ð´ÐµÐ²Ð°Ð»ÐºÐµ Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒÑŽ Â«Ð­Ñ‚Ð¾Ñ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð±Ð¾Ð¸Ñ‚ÑÑ Ð¶ÐµÐ»ÐµÐ·Ð°Â». ðŸ“¸ðŸ˜±',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð¾Ð´Ð¾Ð±Ñ€Ð¸Ð» ÑÐ¿Ð¸ÑÐ¾Ðº, Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð»: Â«ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼, ÐºÑ‚Ð¾ Ð²Ñ‹Ð¶Ð¸Ð²ÐµÑ‚.Â» ÐÐµ Ð±ÑƒÐ´ÑŒÑ‚Ðµ ÑÐ»Ð°Ð±Ð°ÐºÐ¾Ð¼ â€” Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚Ðµ. ðŸ’€ðŸ”¥',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ Ð·Ð²Ð¾Ð½Ð¸Ñ‚ Ð² ÐºÐ¾Ð»Ð¾ÐºÐ¾Ð» Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸. Ð’ÑÐµ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»Ð¸ÑÑŒ, Ð½Ð¾ Ð¾Ð½ Ð½Ðµ Ð²ÐµÑ€Ð¸Ñ‚. Ð”Ð¾ÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð½Ðµ Ð¼ÑƒÑÐ¾Ñ€. â°',
    'Ð Ð¾Ð Ð¾ ÑÐºÑ€ÐµÑÑ‚Ð¸Ð» Ñ€ÑƒÐºÐ¸: Â«ÐÑƒ Ñ‡Ñ‚Ð¾, Ð³ÐµÑ€Ð¾Ð¸?Â» Ð•ÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ â€” Ð¾Ð½ Ð»Ð¸Ñ‡Ð½Ð¾ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ Ð·Ð° Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸. ðŸš”ðŸ’¢',
    "Ð’ÑÐµ Ð² ÑÐ¿Ð¸ÑÐºÐµ? ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾. Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ð» 'Ð½Ð°Ð³Ñ€Ð°Ð´Ñƒ' Ð´Ð»Ñ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾, ÐºÑ‚Ð¾ Ð½Ðµ ÑÐ²Ð¸Ñ‚ÑÑ. ðŸ†ðŸ’€",
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð²ÑÐµ Ð¿Ñ€Ð¸Ð¹Ð´ÐµÑ‚Ðµ â€” Ñ ÑƒÐ´Ð¸Ð²Ð»ÑŽÑÑŒ.Â» ÐÐµ Ð´Ð°Ð¹Ñ‚Ðµ ÐµÐ¼Ñƒ ÑƒÑÐ¾Ð¼Ð½Ð¸Ñ‚ÑŒÑÑ Ð² Ð²Ð°Ñ. â°',
    'Ð Ð¾Ð Ð¾ ÐºÐ¸Ð²Ð°ÐµÑ‚: Â«Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº. Ð–Ð°Ð»ÑŒ, ÐµÑÐ»Ð¸ Ð¾Ð½ Ð¾ÐºÐ°Ð¶ÐµÑ‚ÑÑ Ñ„ÐµÐ¹ÐºÐ¾Ð¼.Â» ÐÐµ Ð¿Ð¾Ð´Ð²ÐµÐ´Ð¸Ñ‚Ðµ â€” Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð¿Ð¾ÑÐ¼ÐµÑˆÐ¸Ñ‰ÐµÐ¼. ðŸ˜¤',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚ Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ð¸ ÑˆÐµÐ¿Ñ‡ÐµÑ‚: Â«Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€ÑƒÐ¿Ð¾Ð² Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð²Ñ‚Ñ€Ð°?Â» ÐÐµ Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð¾Ð´Ð½Ð¸Ð¼ Ð¸Ð· Ð½Ð¸Ñ…. âš°ï¸ðŸ’ª',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑƒÐ»Ñ‹Ð±Ð°ÐµÑ‚ÑÑ: Â«Ð’Ñ‹ Ð²ÑÐµ Ñ‚Ð°ÐºÐ¸Ðµ Ñ…Ñ€Ð°Ð±Ñ€Ñ‹Ðµ Ð½Ð° Ð±ÑƒÐ¼Ð°Ð³Ðµ...Â» Ð”Ð¾ÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÑ‚Ñ€Ð¾Ñ‡ÐºÐ¸ Ð² ÑÐ¿Ð¸ÑÐºÐµ. â°',
    'Ð Ð¾Ð Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«Ð•ÑÐ»Ð¸ Ð²ÑÐµ Ð¿Ñ€Ð¸Ð´ÑƒÑ‚ â€” Ñ ÐºÑƒÐ¿Ð»ÑŽ Ð¿Ð¸Ñ†Ñ†Ñƒ. ÐÐ¾ Ñ Ð½Ðµ Ð²ÐµÑ€ÑŽ Ð² ÑÑ‚Ð¾.Â» ÐÐµ Ð´Ð°Ð¹Ñ‚Ðµ ÐµÐ¼Ñƒ ÑÐºÑƒÐ¿Ð¸Ñ‚ÑŒ Ð²ÑÑŽ Ð¿Ð¸Ñ†Ñ†Ñƒ Ð² Ð³Ð¾Ñ€Ð¾Ð´Ðµ. ðŸ•ðŸ˜',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð²ÐµÐ´ÐµÑ‚ ÑƒÑ‡ÐµÑ‚. Ð•ÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ â€” ÐµÐ³Ð¾ Ð¸Ð¼Ñ Ð·Ð°Ð½ÐµÑÑƒÑ‚ Ð² Â«ÐšÐ½Ð¸Ð³Ñƒ ÑÐ»Ð°Ð±Ð°ÐºÐ¾Ð²Â». ðŸ“–ðŸ’€',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ Ð·Ð²Ð¾Ð½Ð¸Ñ‚ Ð² ÐºÐ¾Ð»Ð¾ÐºÐ¾Ð»: Â«ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð·Ð²Ð¾Ð½Ð¾Ðº Ð´Ð»Ñ Ñ‚ÐµÑ…, ÐºÑ‚Ð¾ ÐµÑ‰Ðµ Ð½Ðµ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»ÑÑ.Â» â°',
];

const slackersMessages = [
    'users, ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾? Ð Ð¾Ð Ð¾ ÑƒÐ¶Ðµ Ñ‚Ð¾Ñ‡Ð¸Ñ‚ Ð³Ð°Ð½Ñ‚ÐµÐ»Ð¸. ÐžÑ‚Ð¼ÐµÑ‡Ð°Ð¹Ñ‚ÐµÑÑŒ: â° /gym â€” Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð¿Ð¾Ð·Ð¾Ñ€Ð¾Ð¼ Ñ€Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¾Ð¹ ÐºÐ°Ñ‡Ð°Ð»ÐºÐ¸. ðŸ’€',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ Ð² ÑÑ€Ð¾ÑÑ‚Ð¸. users, ÐµÑ‰Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¿Ð°ÑÑ‚Ð¸ÑÑŒ: â° /gym. Ð˜Ð»Ð¸ Ð²Ð°Ñ Ð²Ñ‹ÑÑ‚Ð°Ð²ÑÑ‚ Ð½Ð° Â«Ð¡Ð»Ð°Ð±Ð¾?Â». ðŸ˜¤',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚ Ð½Ð° Ð²Ð°Ñ Ñ Ð¿Ñ€ÐµÐ·Ñ€ÐµÐ½Ð¸ÐµÐ¼. users, Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑˆÐ°Ð½Ñ: â° /gym â€” Ð¸Ð»Ð¸ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹ÐºÑ€Ð¸ÐºÐ¸Ð²Ð°Ñ‚ÑŒ Ð² Ð·Ð°Ð»Ðµ ÐºÐ°Ðº Ð¿Ñ€Ð¸Ð¼ÐµÑ€ ÑÐ»Ð°Ð±Ð¾ÑÑ‚Ð¸. ðŸ”¥',
    'users, Ð Ð¾Ð Ð¾ ÑƒÐ¶Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ Ð´Ð»Ñ Ð²Ð°Ñ Â«Ð¾ÑÐ¾Ð±Ñ‹Ð¹Â» ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ. Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ? â° /gym â€” Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð¼ÐµÐ¼Ð¾Ð¼. ðŸ˜±',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«Ð­Ñ‚Ð¸ users â€” Ð¿Ð¾Ð·Ð¾Ñ€ Ñ€Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¾Ð¹ ÐºÐ°Ñ‡Ð°Ð»ÐºÐ¸.Â» Ð˜ÑÐ¿Ñ€Ð°Ð²ÑŒÑ‚ÐµÑÑŒ: â° /gym. ðŸ‹ï¸â€â™‚ï¸ðŸ’¢',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ users Ð² Â«ÐšÐ½Ð¸Ð³Ñƒ ÑÐ»Ð°Ð±Ð°ÐºÐ¾Ð²Â». Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð²Ñ‹Ñ‡ÐµÑ€ÐºÐ½ÑƒÑ‚ÑŒÑÑ? â° /gym â€” Ð¸Ð»Ð¸ Ð²Ð°Ñ Ð±ÑƒÐ´ÑƒÑ‚ Ð²ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ñ‚ÑŒ ÐºÐ°Ðº Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ñ‚Ð¾Ð³Ð¾, ÐºÐ°Ðº ÐÐ• Ð½Ð°Ð´Ð¾. ðŸ“–',
    'Ð Ð¾Ð Ð¾ Ð·Ð²Ð¾Ð½Ð¸Ñ‚ Ð² ÐºÐ¾Ð»Ð¾ÐºÐ¾Ð» Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸. users, Ð²Ñ‹ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ, ÐºÑ‚Ð¾ ÐµÑ‰Ðµ Ð½Ðµ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»ÑÑ. â° /gym â€” Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð»ÐµÐ³ÐµÐ½Ð´Ð¾Ð¹ Ð»ÐµÐ½Ð¸. ðŸ’€',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐ¼ÐµÐµÑ‚ÑÑ: Â«users Ð±Ð¾Ð¸Ñ‚ÑÑ Ð¶ÐµÐ»ÐµÐ·Ð°.Â» Ð”Ð¾ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ðµ: â° /gym. ðŸ”âž¡ï¸ðŸ¦',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ ÑÐºÐ°Ð·Ð°Ð»: Â«Ð•ÑÐ»Ð¸ users Ð½Ðµ Ð¿Ñ€Ð¸Ð´ÑƒÑ‚ â€” Ñ Ð»Ð¸Ñ‡Ð½Ð¾ Ð¿Ñ€Ð¸Ð´Ñƒ Ð·Ð° Ð½Ð¸Ð¼Ð¸.Â» Ð¨ÑƒÑ‚ÐºÐ¸ ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð¸ÑÑŒ. â° /gym. ðŸš”',
    'Ð Ð¾Ð Ð¾ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚ Ð½Ð° users Ð¸ ÐºÐ°Ñ‡Ð°ÐµÑ‚ Ð³Ð¾Ð»Ð¾Ð²Ð¾Ð¹. Â«ÐŸÐ¾Ð·Ð¾Ñ€. Ð Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¾Ð¹. ÐšÐ°Ñ‡Ð°Ð»ÐºÐ¸.Â» Ð˜ÑÐ¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾: â° /gym. ðŸ˜¤',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«users, Ð²Ñ‹ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸.Â» ÐÐ¾ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°Ñ‚ÑŒ: â° /gym. â³',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð²ÐµÐ´ÐµÑ‚ Ñ‡ÐµÑ€Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº. users, Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð² Ð½ÐµÐ³Ð¾ Ð¿Ð¾Ð¿Ð°ÑÑ‚ÑŒ? ÐÐµÑ‚? Ð¢Ð¾Ð³Ð´Ð° â° /gym. ðŸ“œ',
    'Ð Ð¾Ð Ð¾ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ Â«ÑÑŽÑ€Ð¿Ñ€Ð¸Ð·Â» Ð´Ð»Ñ users. Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ ÐµÐ³Ð¾ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ? â° /gym. ðŸŽðŸ’€',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«users, Ð²Ñ‹ â€” ÑÐ»Ð°Ð±Ð¾Ðµ Ð·Ð²ÐµÐ½Ð¾. ÐŸÑ€Ð¾Ñ‰Ð°Ð¹Ñ‚Ðµ.Â» Ð˜Ð»Ð¸ Ð½ÐµÑ‚? â° /gym. â›“ï¸',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð·Ð°Ð¿Ð¸ÑÐ°Ð» users Ð² ÑÐ¿Ð¸ÑÐ¾Ðº Â«Ð›ÑŽÐ´Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ð¾ÑÑ‚ÑÑ Ð¿Ð¾Ñ‚Ð°Â». Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒÑÑ? â° /gym. ðŸ’¦',
    'Ð Ð¾Ð Ð¾ Ð·Ð¾Ð²ÐµÑ‚ users: Â«ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑˆÐ°Ð½Ñ.Â» â° /gym â€” Ð¸Ð»Ð¸ Ð²Ð°Ñ Ð²Ñ‹ÑÑ‚Ð°Ð²ÑÑ‚ Ð½Ð° Ð²ÑÐµÐ¾Ð±Ñ‰ÐµÐµ Ð¾ÑÐ¼ÐµÑÐ½Ð¸Ðµ. ðŸŽ¤',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«users, Ð²Ñ‹ ÑƒÐ¶Ðµ Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð² Ð¼ÑƒÑÐ¾Ñ€ÐºÐµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸.Â» Ð’Ñ‹Ñ‚Ð°Ñ‰Ð¸Ñ‚Ðµ ÑÐµÐ±Ñ: â° /gym. ðŸ—‘ï¸',
    'Ð Ð¾Ð¼Ð°Ð½ Ð‘Ð¾Ñ€Ð¸ÑÑ‹Ñ‡ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» users Ð² Â«Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð½Ð° Ñ€Ð°ÑÑ‚ÐµÑ€Ð·Ð°Ð½Ð¸ÐµÂ». Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð²Ñ‹Ñ‡ÐµÑ€ÐºÐ½ÑƒÑ‚ÑŒÑÑ? â° /gym. ðŸ¦',
    'Ð Ð¾Ð Ð¾ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚ Ð½Ð° users Ð¸ Ð²Ð·Ð´Ñ‹Ñ…Ð°ÐµÑ‚: Â«Ð–Ð°Ð»ÑŒ.Â» ÐÐ¾ ÐµÑ‰Ðµ Ð½Ðµ Ð¿Ð¾Ð·Ð´Ð½Ð¾: â° /gym. â³',
    'Ð™Ð¾Ð·Ðµ ÐœÐ°Ñ€Ð¸Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ð»: Â«users, Ð²Ð°Ñ ÑƒÐ¶Ðµ Ð½ÐµÑ‚.Â» Ð”Ð¾ÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð½Ðµ Ñ‚Ð°Ðº: â° /gym. ðŸ’€ðŸ”¥',
];

const sendDailyMessage = async (...[bot, chatId]: CronJobParameters) => {
    const chatData = loadChatData(chatId);
    const today = new Date();
    const month = today.getMonth();
    const date = today.getDate();

    const participants = chatData.participants || [];
    const slackers = participants.filter(({ id }) => !chatData[month]?.[id]?.[date]);

    const isMolodchikiParni = slackers.length === 0;
    const videoFileName = isMolodchikiParni ? 'success.mp4' : 'angry_cat.mp4';
    const audioFileName = isMolodchikiParni ? 'davai.ogg' : 'wake_up.ogg';

    await bot.telegram.sendVideo(chatId, { source: getMediaFilePath(videoFileName) });
    await bot.telegram.sendAudio(
        chatId,
        { source: getMediaFilePath(audioFileName) },
        {
            caption: isMolodchikiParni
                ? getRandom(allMarkedMessages)
                : getRandom(slackersMessages).replace('users', slackers.map(getUsernameTag).join(', ')),
        }
    );
};

const handleTick = (...params: CronJobParameters) => {
    if (TRAINING_CONFIG.idealDaysOfWeek.includes(new Date().getDay())) {
        sendDailyMessage(...params);
    }
};

const chatIdsMap: ChatIdsMap = {};

export const createDailyCronJob = (...[bot, chatId]: Partial<CronJobParameters>) => {
    if (!chatId || !bot || chatId in chatIdsMap) {
        return;
    }

    const { dailyCronConfig } = TRAINING_CONFIG;
    // Ð•Ð´Ð¸Ð½Ñ‹Ð¹ CronJob, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ
    const cronTime = `${dailyCronConfig.minute} ${dailyCronConfig.hour} * * *`; // ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² hour:minute
    const job = new CronJob(
        cronTime,
        () => handleTick(bot, chatId),
        null, // onComplete
        true, // start
        'Europe/Moscow'
    );

    chatIdsMap[chatId] = true;

    return job;
};
