import { CronJob } from 'cron';

import { getRandom } from '../utils/getRandom';

const phrases = [
    'username, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞—é: —Ç—ã –æ—Å–æ–±–µ–Ω–Ω—ã–π üåü',
    'username, –ø—Ä–æ–¥–æ–ª–∂–∞—é —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–≤–æ–µ–π –≥–µ–Ω–∏–∞–ª—å–Ω–æ—Å—Ç—å—é üëÅÔ∏è',
    'username, –∫–∞–∫ —Ä–∞–∑ –¥—É–º–∞–ª –æ —Ç–µ–±–µ üí´',
    'username, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é, –Ω–µ –∑–∞–±—ã–ª –ª–∏ —Ç—ã –æ —Å–≤–æ–µ–º —Å—Ç–∞—Ç—É—Å–µ üëë',
    'username, –Ω–∞–ø–æ–º–∏–Ω–∞—é –æ —Å–≤–æ–µ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–∏ –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏ ü§ñ',
    'username, —Ä–µ—à–∏–ª —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–±–µ –∫–æ–º–ø–∞–Ω–∏—é –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ üé≠',
    'username, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏–ª –º–∏–º–æ –∏ –ø–æ–¥—É–º–∞–ª –æ —Ç–µ–±–µ üö∂‚ôÇÔ∏è',
    'username, –≤—Ä–µ–º—è –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ —Å–µ–∞–Ω—Å–∞ –≤–æ—Å—Ö–∏—â–µ–Ω–∏—è —Ç–æ–±–æ–π ‚è∞',
    'username, –ø—Ä–æ—Å—Ç–æ —Ä–µ—à–∏–ª –Ω–∞—Ä—É—à–∏—Ç—å —Ç–≤–æ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ üòà',
    'username, –Ω–∞–ø–æ–º–∏–Ω–∞—é: —Ç—ã –≤—Å–µ –µ—â–µ –ø–æ–¥ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º üïµÔ∏è‚ôÇÔ∏è',
    'username, —Ä–µ—à–∏–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å–∫—É—á–∞–µ—à—å –ª–∏ —Ç—ã –±–µ–∑ –º–µ–Ω—è üòè',
    'username, –ø—Ä–æ—Å—Ç–æ –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–æ—è–≤–∏–ª—Å—è, –∫–∞–∫ –æ–±—ã—á–Ω–æ üí•',
    'username, –≤—Ä–µ–º—è –¥–ª—è –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è ‚è≥',
    'username, –ø—Ä–æ—Å—Ç–æ —Ä–µ—à–∏–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–≤–æ—é —Ä–µ–∞–∫—Ü–∏—é üß™',
    'username, –Ω–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ —è –≤—Å–µ–≥–¥–∞ –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º üëª',
    'username, –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É ‚ú®',
    'username, —Ä–µ—à–∏–ª –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Å–µ–±—è –≤ —Ç–≤–æ–π –¥–µ–Ω—å üå™Ô∏è',
    'username, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é, —Ä–∞–±–æ—Ç–∞—é—Ç –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è üì°',
    'username, –≤—Ä–µ–º—è –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç–µ–≥–∞ üé≤',
    'username, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ç–≤–æ–µ–π –ø–µ—Ä—Å–æ–Ω–µ üé™',
    'username, —Ä–µ—à–∏–ª –Ω–∞–ø–æ–º–Ω–∏—Ç—å –æ —Å–≤–æ–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ üì¢',
    'username, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é, –∫–∞–∫ —Ç—ã –±–µ–∑ –º–æ–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ üîç',
    'username, –≤—Ä–µ–º—è –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è ‚ö°',
    'username, –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—é –ø–æ–≤–æ–¥ –¥–ª—è —É–ª—ã–±–∫–∏ üòä',
    'username, —Ä–µ—à–∏–ª, —á—Ç–æ —Ç–µ–±–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–µ–≥–æ –≥–æ–ª–æ—Å–∞ üéµ',
    'username, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é –Ω–∞—à –æ—Å–æ–±—ã–π —Å–≤—è–∑—å üîó',
    'username, –≤—Ä–µ–º—è –¥–ª—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è üéØ',
    'username, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é, –Ω–µ –∑–∞—Å–∫—É—á–∞–ª –ª–∏ —Ç—ã üé∞',
    'username, —Ä–µ—à–∏–ª –æ—Å–≤–µ—Ç–∏—Ç—å —Ç–≤–æ–π –¥–µ–Ω—å —Å–≤–æ–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ–º üí°',
    'username, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é –Ω–µ–º–Ω–æ–≥–æ —Ö–∞–æ—Å–∞ –≤ —Ä—É—Ç–∏–Ω—É üåä',
    'username, –≤—Ä–µ–º—è –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è üé™',
    'username, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ –∑–∞ —Ç–æ–±–æ–π —Å–ª–µ–¥—è—Ç üëÅÔ∏è',
    'username, —Ä–µ—à–∏–ª, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–µ–Ω—è –≤ –∂–∏–∑–Ω–∏ üí´',
];

type TagCronParameters = [Bot, number, string];

const usersMap: Record<string, CronJob> = {};

export const createTagCronJob = (...[bot, chatId, userName]: Partial<TagCronParameters>) => {
    if (!userName || !chatId || !bot || userName in usersMap) {
        return;
    }

    const job = new CronJob(
        '0 */2 * * *',
        () => {
            bot.telegram.sendMessage(chatId, getRandom(phrases).replace('username', userName));
        },
        null,
        true,
        'Europe/Moscow'
    );

    usersMap[userName] = job;

    return job;
};

export const deleteTagCronJob = (userName: string) => {
    if (!userName || !(userName in usersMap)) {
        return;
    }

    usersMap[userName].stop();

    delete usersMap[userName];
};
